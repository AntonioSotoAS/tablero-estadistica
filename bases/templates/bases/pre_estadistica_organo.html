{% extends "base/base.html" %}
{% load static %}
<title>{% block title %} Jueces Listar :: Estadistica {% endblock %} </title>
{% block wrapper %}
<body class="hold-transition layout-top-nav">

        <div class="content">
            <div class="container">
              <div class="row mt-3">
                <div class="col-12">
                  <div class="card mb-4">
                    <div class="user-profile-header d-flex flex-column flex-lg-row text-sm-start text-center">
                      <img
                          src="{% static "base/img/Icon/grafico_n.png" %}"
                          alt="user image"
                          class=" rounded p-3" width="105" height="100" />
                      <div class="flex-grow-1 ">
                        <div class="d-flex align-items-md-end align-items-sm-start align-items-center justify-content-md-between justify-content-start mx-5 flex-md-row flex-column gap-4">
                          <div class="user-profile-info">
                              <h4 class="mb-0 mt-lg-6">Estadística por Organo Jurisdiccional</h4>
                              <h6> <a href="{% url "bases:presidencia" %}">Tablero de Control </a><span> <a href="{% url "bases:estadistica_menu" %}">/ Estadística </a></span><span>/ Estadística por Órgano Jurisdiccional </span></h6>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row g-6">
                <div class="col-12">
                  <div class="card">
                    
                    <div class="card-header pt-3 pb-2">
                      <h3 class="font-weight-bold mb-1 pb-1">BUSCAR ORGANO JURISDICCIONAL</h3>
                    </div>
        
                      <div class="card-body">
                        <div class="row">
                        <div class="col-xl-10 col-lg-6 col-md-7 col-sm-8 col-12">
                          <select class="select2 form-control form-control-lg w-100" id="instanciaSelect" style="max-width: 400px;">
                            <option value="">Seleccione una instancia</option>
                            {% for instancia in instancias %}
                                <option value="{{ instancia.n_instancia_id }}">{{ instancia.x_nom_instancia }}</option>
                            {% endfor %}
                          </select>
                        </div>
        
                        <div class="col-xl-2 col-lg-6 col-md-5 col-sm-4 col-12 d-grid">
                          <button id="buscarInstancia" type="button" class="btn btn-dark btn-lg">
                            <i class="ti ti-search ti-md"> </i> CONSULTAR
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            
                  <div id="resultados">
                  </div>

            </div>
        </div>
        <!-- /.content -->

    {% endblock %}

    {% block script %} 
    <script>
      $(document).ready(function() {
        $('#instanciaSelect').select2({
          placeholder: "Seleccione una instancia",
          allowClear: true
        });
      
        document.getElementById('buscarInstancia').addEventListener('click', function(event) {
          event.preventDefault();
      
          const instanciaId = document.getElementById('instanciaSelect').value;
      
          if (instanciaId) {
            fetch(`datos/?instancia_id=${instanciaId}`, {
              headers: {
                "X-Requested-With": "XMLHttpRequest",
              },
            })
            .then(response => response.json())
            .then(data => {
              const resultadosDiv = document.getElementById('resultados');
              resultadosDiv.innerHTML = '';
      
              if (data.datos && data.datos.length > 0) {
                data.datos.forEach((item, index) => {
                  const canvasId = `graficoIngresosResueltos_${index}`;
                        resultadosDiv.innerHTML += `
                        <div class="card mt-3">
                          <div class="card-header">
                            <h3 class="card-tittle font-weight-bold text-center p-0 m-0">${item.n_instancia__x_nom_instancia}</h3>
                          </div>
    
                          <div class="card-body">
                            <div class="row">
                              <div class="col-xxl-4 col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 mb-3">
                                ${
                                  item.x_niv_produc === "MUY BUENO"
                                    ? `
                                      <div class="card card-border-shadow-success">
                                        <div class="d-flex align-items-center row">
                                          <div class="col-7">
                                            <div class="card-body mt-0 text-nowrap">
                                              <h5 class="card-title mb-0 mt-0 text-dark font-weight-bold">NIVEL DE PRODUCTIVIDAD</h5>
                                              <h4><span class="badge bg-success ">${item.x_niv_produc}</span></h4> 
                                            </div>
                                          </div>
        
                                          <div class="col-5 d-flex align-items-start">
                                            <div class="card-body d-flex align-items-start pt-0 mt-0">
                                              <img src="{% static "base/img/Svg/medalla.svg" %}" height="140" alt="medalla" />
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    `
                                    :
                                    item.x_niv_produc === "BUENO"
                                    ?`
                                      <div class="card card-border-shadow-warning">
                                        <div class="d-flex align-items-center row">
                                          <div class="col-7">
                                            <div class="card-body mt-0 text-nowrap">
                                              <h5 class="card-title mb-0 mt-0 text-dark font-weight-bold">NIVEL DE PRODUCTIVIDAD</h5>
                                              <h4><span class="badge bg-warning text-dark">${item.x_niv_produc}</span></h4>
                                            </div>
                                          </div>
        
                                          <div class="col-5 d-flex align-items-start">
                                            <div class="card-body d-flex align-items-start pt-0 mt-0">
                                              <img src="{% static "base/img/Svg/medalla_plata.svg" %}" height="140" alt="medalla" />
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    `
                                    :
                                    `
                                      <div class="card card-border-shadow-danger">
                                        <div class="d-flex align-items-center row">
                                          <div class="col-7">
                                            <div class="card-body mt-0 text-nowrap">
                                              <h5 class="card-title mb-0 mt-0 text-dark font-weight-bold">NIVEL DE PRODUCTIVIDAD</h5>
                                              <h4><span class="badge bg-danger">${item.x_niv_produc}</span></h4>
                                            </div>
                                          </div>
        
                                          <div class="col-5 d-flex align-items-start">
                                            <div class="card-body d-flex align-items-start pt-0 mt-0">
                                              <img src="{% static "base/img/Svg/medalla_bronce.svg" %}" height="140" alt="medalla" />
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    `
                                }
                              </div>
    
                              <div class="col-xxl-4 col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 mb-3">
                                ${
                                  item.IER >= 90
                                    ? `
                                      <div class="card card-border-shadow-success">
                                        <div class="row  d-flex align-items-center">
                                          <div class="col-7">
                                              <h5 class="mb-0 mt-0 text-center text-dark font-weight-bold">Indicador de Expedientes Resueltos (IER)</h5>
                                              <h4 class="text-center"><span class="badge bg-success">${item.IER}%</span></h4>
                                          </div>
        
                                          <div class="col-5 d-flex align-items-center justify-content-center">
                                            <div class="card-body d-flex align-items-center pt-0 mt-0">
                                              <img src="{% static "base/img/Svg/subcarga.svg" %}" height="140" alt="medalla" class="pt-2"/>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    `
                                    :
                                    item.IER >= 50
                                    ?`
                                      <div class="card card-border-shadow-warning">
                                        <div class="row  d-flex align-items-center">
                                          <div class="col-7">
                                              <h5 class="mb-0 mt-0 text-center text-dark font-weight-bold">Indicador de Expedientes Resueltos (IER)</h5>
                                              <h4 class="text-center"><span class="badge bg-warning">${item.IER}%</span></h4>
                                          </div>
        
                                          <div class="col-5 d-flex align-items-center justify-content-center">
                                            <div class="card-body d-flex align-items-center pt-0 mt-0">
                                              <img src="{% static "base/img/Svg/estandar.svg" %}" height="140" alt="medalla" class="pt-2"/>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    `
                                    :
                                    `
                                      <div class="card card-border-shadow-danger">
                                        <div class="row  d-flex align-items-center">
                                          <div class="col-7">
                                              <h5 class="mb-0 mt-0 text-center text-dark font-weight-bold">SITUACIÓN DE LA CARGA EN TRÁMITE</h5>
                                              <h4 class="text-center"><span class="badge bg-danger">${item.IER}%</span></h4>
                                          </div>
        
                                          <div class="col-5 d-flex align-items-center justify-content-center">
                                            <div class="card-body d-flex align-items-center pt-0 mt-0">
                                              <img src="{% static "base/img/Svg/sobrecarga.svg" %}" height="140" alt="medalla" class="pt-2"/>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    `
                                }
                              </div>
        
                              <div class="col-xxl-4 col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 mb-3">
                                ${
                                  item.x_situacion_carga === "SUBCARGA"
                                  ? `
                                    <div class="card card-border-shadow-success">
                                      <div class="row  d-flex align-items-center">
                                        <div class="col-7">
                                            <h5 class="mb-0 mt-0 text-center text-dark font-weight-bold">SITUACIÓN DE LA CARGA EN TRÁMITE</h5>
                                            <h4 class="text-center"><span class="badge bg-success">${item.x_situacion_carga}</span></h4>
                                        </div>
      
                                        <div class="col-5 d-flex align-items-center justify-content-center">
                                          <div class="card-body d-flex align-items-center pt-0 mt-0">
                                            <img src="{% static "base/img/Svg/verde_subcarga.svg" %}" height="140" alt="medalla" class="pt-2"/>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  `
                                  :
                                  item.x_situacion_carga === "ESTANDAR"
                                  ?`
                                    <div class="card card-border-shadow-warning">
                                      <div class="row  d-flex align-items-center">
                                        <div class="col-7">
                                            <h5 class="mb-0 mt-0 text-center text-dark font-weight-bold">SITUACIÓN DE LA CARGA EN TRÁMITE</h5>
                                              <h4 class="text-center"><span class="badge bg-warning">${item.x_situacion_carga}</span></h4>
                                        </div>
      
                                        <div class="col-5 d-flex align-items-center justify-content-center">
                                          <div class="card-body d-flex align-items-center pt-0 mt-0">
                                            <img src="{% static "base/img/Svg/ama_estandar.svg" %}" height="100" alt="medalla" class="pt-2"/>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  `
                                  :
                                  `
                                    <div class="card card-border-shadow-danger">
                                      <div class="row  d-flex align-items-center">
                                        <div class="col-7">
                                            <h5 class="mb-0 mt-0 text-center text-dark font-weight-bold">Indicador de Expedientes Resueltos (IER)</h5>
                                              <h4 class="text-center"><span class="badge bg-danger">${item.x_situacion_carga}</span></h4>
                                        </div>
      
                                        <div class="col-5 d-flex align-items-center justify-content-center">
                                          <div class="card-body d-flex align-items-center pt-0 mt-0">
                                            <img src="{% static "base/img/Svg/rojo_sobrecarga.svg" %}" height="140" alt="medalla" class="pt-2"/>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  `
                                }
                              </div>
                            </div>
                          </div>
                        </div>
    
                        <div class="card mt-3">
                          <div class="card-header">
                            <h5 class="card-tittle font-weight-bold p-0 m-0">METAS Y AVANCE</h5>
                          </div>
    
                          <div class="card-body pb-0">
                            <div class="row">
                              <div class="col-xxl-5 col-lg-12 col-md-12 mb-6 mt-3 pr-3">
                                <ul class="p-0 m-0">
                                  <li class="mb-6 d-flex justify-content-between align-items-center">
                                    <div class="badge bg-label-dark rounded p-1_5"><i class="ti ti-star ti-md"></i></div>
                                    <div class="d-flex justify-content-between w-100 flex-wrap">
                                      <h5 class="mb-0 ms-4">Estándar de Producción</h5>
                                      <div class="d-flex">
                                        <h5 class="mb-0">${item.m_estandar_prod}</h5>
                                      </div>
                                    </div>
                                  </li>
                                  <li class="mb-6 d-flex justify-content-between align-items-center">
                                    <div class="badge bg-label-dark rounded p-1_5"><i class="ti ti-target-arrow ti-md"></i></div>
                                    <div class="d-flex justify-content-between w-100 flex-wrap">
                                      <h5 class="mb-0 ms-4">Meta Proyectada</h5>
                                      <div class="d-flex">
                                        <h5 class="mb-0">${item.m_meta_preliminar}</h5>
                                      </div>
                                    </div>
                                  </li>
                                  <li class="mb-6 d-flex justify-content-between align-items-center">
                                    <div class="badge bg-label-dark rounded p-1_5"><i class="ti ti-books ti-md"></i></div>
                                    <div class="d-flex justify-content-between w-100 flex-wrap">
                                      <h5 class="mb-0 ms-4">Carga Procesal Inicial (01-Ene-2025)</h5>
                                      <div class="d-flex">
                                        <h5 class="mb-0">${item.n_carg_procesal_ini}</h5>
                                      </div>
                                    </div>
                                  </li>
                                  <li class="mb-6 d-flex justify-content-between align-items-center">
                                    <div class="badge bg-label-dark rounded p-1_5"><i class="ti ti-file ti-md"></i></div>
                                    <div class="d-flex justify-content-between w-100 flex-wrap">
                                      <h5 class="mb-0 ms-4">Total de Expedientes Ingresados</h5>
                                      <div class="d-flex">
                                        <h5 class="mb-0">${item.m_t_ingreso}</h5>
                                      </div>
                                    </div>
                                  </li>
                                  <li class="mb-6 d-flex justify-content-between align-items-center">
                                    <div class="badge bg-label-dark rounded p-1_5"><i class="ti ti-file-check ti-md"></i></div>
                                    <div class="d-flex justify-content-between w-100 flex-wrap">
                                      <h5 class="mb-0 ms-4">Total de Expedientes Resueltos</h5>
                                      <div class="d-flex">
                                        <h5 class="mb-0">${item.m_t_resuelto}</h5>
                                      </div>
                                    </div>
                                  </li>
                                </ul>
                              </div>
    
                              <div class="col-xxl-6 col-lg-12 col-md-12 offset-xxl-1 mb-2 pl-3">
                                <canvas id="${canvasId}" width="500" height="200"></canvas>
                              </div>  
                            </div>
                          </div>
                        </div>
    
                        <div class="card mt-3">
                          <div class="card-header">
                            <h5 class="card-tittle mb-0 p-2">PORCENTAJE DE AVANCE</h5>
                          </div>
    
                          <div class="card-body">
                            <div class="row">
                              <div class="col-6">
                                <div class="d-flex justify-content-between align-items-center gap-3">
                                  <h5 class="mb-0">% Ideal de Avance de Meta Redondeado</h5>
                                  <h5 class="text-muted mb-0">${item.m_ideal_avan_meta}%</h5>
                                </div>
                                <div class="d-flex align-items-center mt-1 mb-2">
                                  <div class="progress w-100" style="height: 8px">
                                    <div
                                      class="progress-bar bg-dark"
                                      style="width: ${item.m_ideal_avan_meta}%"
                                      role="progressbar"
                                      aria-valuenow="${item.m_ideal_avan_meta}%"
                                      aria-valuemin="0"
                                      aria-valuemax="100">
                                    </div>
                                  </div>
                                </div>
    
                                <div class="d-flex justify-content-between align-items-center gap-3 pt-2">
                                  <h5 class="mb-0">% Real de Avance de Meta</h5>
                                  <h5 class="text-muted mb-0">${item.m_avan_meta}%</h5>
                                </div>
                                
                                <div class="d-flex align-items-center mt-1">
                                  <div class="progress w-100" style="height: 8px">
                                    <div
                                      class="progress-bar bg-info"
                                      style="width: ${item.m_avan_meta}%"
                                      role="progressbar"
                                      aria-valuenow="${item.m_avan_meta}"
                                      aria-valuemin="0"
                                      aria-valuemax="100">
                                    </div>
                                  </div>
                                </div>
                              </div>
    
                              <div class="col-lg-3 col-sm-12">
                                <div class="card card-border-shadow-info h-100">
                                  <div class="card-body">
                                    <div class="d-flex align-items-center mb-2">
                                      <h3 class="mb-0">${item.m_niv_bueno}</h3>
                                    </div>
                                    <h5 class="mb-1">Cantidad de Expedientes para Alcanzar el N.P. "BUENO"</h5>
                                  </div>
                                </div>
                              </div>
    
                              <div class="col-lg-3 col-sm-12">
                                <div class="card card-border-shadow-info h-100">
                                  <div class="card-body">
                                    <div class="d-flex align-items-center mb-2">
                                      <h3 class="mb-0">${item.m_niv_muy_bueno}</h3>
                                    </div>
                                    <h5 class="mb-1">Cantidad de Expedientes para Alcanzar el N.P. "MUY BUENO"</h5>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        `;
    
                        
                        // Generar gráfico con Chart.js
                        setTimeout(() => {
                          const ctx = document.getElementById(canvasId).getContext('2d');
                          new Chart(ctx, {
                            type: 'bar',
                            data: {
                              labels: ['Expedientes Ingresados', 'Expedientes Resueltos'],
                              datasets: [{
                                label: 'Expedientes',
                                data: [item.m_t_ingreso, item.m_t_resuelto],
                                backgroundColor: ['#4e73df', '#1cc88a']
                              }]
                            },
                            options: {
                              indexAxis: 'y', // ← Esto convierte la gráfica en horizontal
                              responsive: true,
                              plugins: {
                                legend: { display: false },
                                title: {
                                  display: true,
                                  text: 'Gráfica de Expedientes Totales Ingresados vs Totales Resueltos'
                                },
                                datalabels: {
                                  anchor: 'center',
                                  align: 'center',
                                  color: '#fff',
                                  font: {
                                    weight: 'bold',
                                    size: 16
                                  },
                                  formatter: Math.round
                                }
                              },
                              scales: {
                                x: {
                                  beginAtZero: true
                                }
                              }
                            },
                            plugins: [ChartDataLabels] 
                          });
                        }, 100);
    
                      });
                    } else {
                      resultadosDiv.innerHTML = '<div class="alert alert-info">No se encontraron resultados.</div>';
                  }
                });
              }
            });
          });
        </script>
    
    {% endblock %}

 