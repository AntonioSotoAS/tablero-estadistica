{% extends "base/base.html" %}
{% load static %}
{% block title %} Configuracion de Metas :: Estadistica {% endblock %}

{% block datatable_css %}
<link rel="stylesheet" href="{% static 'base/vendor/datatables/dt/datatables.bootstrap5.css' %}" />
<link rel="stylesheet" href="{% static 'base/vendor/datatables/responsive/responsive.bootstrap5.css' %}" />
<link rel="stylesheet" href="{% static 'base/vendor/datatables/checkboxes/datatables.checkboxes.css' %} "/>
{% endblock  %}

{% block body_container %}
<div class="container-xxl flex-grow-1 container-p-y">
    {# Mensajes de Django #}
    <div class="row">
        <div class="col-12">
            <div class="row mt-2">
                <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mb-2">
                    <div class="card">
                        <div class="d-flex align-items-end row">
                            <div class="col-12">
                                <div class="card-body">
                                    <h2 class="card-title mb-0 font-weight-bold lh-1">Configuración de metas — {{ month_name|capfirst }} {{ year }}</h2>
                                    <small class="text-muted">
                                        Instancias configuradas: <strong>{{ existentes }}</strong> /
                                        <strong>{{ inst_total }}</strong>
                                        {% if faltantes > 0 %}
                                            • Faltan: <strong class="text-primary">{{ faltantes }}</strong>
                                        {% else %}
                                            • Todo listo ✅
                                        {% endif %}
                                    </small>


                                    <form action="{{ seed_url }}" method="post">
                                        {% csrf_token %}
                                        <button class="btn btn-label-dark"
                                                {% if faltantes == 0 %}disabled{% endif %}>
                                            Agregar Configuraciones de {{ month_name }} {{ year }}
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users List Table -->
            <div class="card mt-3">
                <div class="card-datatable table-responsive">
                <table class="datatables-users table" id="tableUsuario">
                    <thead class="border-top bg-dark">
                    <tr>
                        <th class="text-center text-white" style="font-size:14px">#</th>
                        <th class="text-center text-white" style="font-size:14px">MES</th>
                        <th class="text-center text-white" style="font-size:14px">AÑO</th>
                        <th class="text-center text-white" style="font-size:14px">ORGANO JURISDICCIONAL</th>
                        <th class="text-center text-white" style="font-size:14px">INSTANCIA</th>
                    </tr>
                    </thead>

                    <tbody>
                        {% for obj in obj %}
                            <tr>
                                <td>{{forloop.counter}}</td>
                                <td class="text-uppercase text-center">{{ obj.n_mes_est }}</td>
                                <td class="text-uppercase text-center">{{ obj.n_anio_est }}</td>
                                <td class="text-uppercase">{{ obj.n_instancia.c_org_jurisd.x_nom_org_jurisd }}</td>
                                <td>{{ obj.n_instancia.x_nom_instancia }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="2" class="text-center">No se encontraron resultados</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block form_js %}
    <script src="{% static 'base/vendor/bootstrap-select/bootstrap-select.js' %}"></script>
    <script src="{% static 'base/vendor/select2/select2.js' %}"></script>
    <script src="{% static 'base/vendor/form-validation/popular.js' %}"></script>
    <script src="{% static 'base/vendor/form-validation/bootstrap5.js' %}"></script>
    <script src="{% static 'base/vendor/form-validation/auto-focus.js' %}"></script>
{% endblock %}

{% block datatable_js %}
    <script src="{% static 'base/vendor/datatables5/datatables-bootstrap5.js' %}"></script>
{% endblock %}

{% block datatable %}
    <script>
        $(document).ready(function () {
            $('#tableUsuario').DataTable({
                "pageLength": 25,
                "lengthMenu": [[25, 40, 50, 100, -1], [25, 40, 50, 100, "Todos"]],
                autoWidth: false,
                responsive: true,
                language: {
                    "sProcessing": "Procesando...",
                    "sLengthMenu": "Mostrar _MENU_ registros",
                    "sZeroRecords": "No se encontraron resultados",
                    "sEmptyTable": "Ningún dato disponible en esta tabla",
                    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "sSearch": "Buscar:",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Último",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"
                    },
                    "oAria": {
                        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                    }
                },
            });
        });
    </script>
{% endblock  %}

{% block script %}
{% endblock  %}